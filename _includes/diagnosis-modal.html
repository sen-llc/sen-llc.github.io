<!-- モーダル本体 -->
<div id="diagnosisModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
  <div class="bg-white w-full max-w-xl rounded-lg shadow-lg overflow-hidden relative animate-fadeIn">
    <button id="closeDiagnosis" class="absolute top-4 right-4 text-xl">&times;</button>

    <div id="stepContainer" class="p-6">
      <!-- Step 1 -->
      <div class="step" data-step="1">
        <h2 class="text-lg font-bold mb-4">Q1｜今の住まいについて教えてください</h2>
        <p class="mb-6">いま、どんなおうちに住んでいますか？</p>
        <div class="flex flex-col gap-4">
          <button class="diagnosis-option" data-value="rent">貸し家（賃貸）</button>
          <button class="diagnosis-option" data-value="own">持ち家</button>
        </div>
      </div>

      <!-- Step 2 -->
      <div class="step hidden" data-step="2">
        <h2 class="text-lg font-bold mb-4">Q2｜これからの住まいについて</h2>
        <p class="mb-6">これから、どんな暮らし方を思い描いていますか？</p>
        <div class="flex flex-col gap-4">
          <button class="diagnosis-option" data-value="want-rent">借りたい</button>
          <button class="diagnosis-option" data-value="want-buy">購入したい</button>
          <button class="diagnosis-option" data-value="want-lease">（いまの住まいを）貸したい</button>
        </div>
      </div>

      <!-- Step 3 -->
      <div class="step hidden" data-step="3">
        <h2 class="text-lg font-bold mb-4">Q3｜住まいとの“育て方”を教えてください</h2>
        <p class="mb-6">どんなふうに住まいと関わっていきたいですか？</p>
        <div class="flex flex-col gap-4">
          <button class="diagnosis-option" data-value="diy">自分で手を動かしたい（DIYしたい）</button>
          <button class="diagnosis-option" data-value="with-pro">プロと一緒につくりたい（設計サポート）</button>
          <button class="diagnosis-option" data-value="unsure">迷っている・相談したい</button>
        </div>
      </div>

      <!-- Step Result -->
      <div class="step hidden" data-step="result">
        <h2 class="text-lg font-bold mb-4">あなたにおすすめの住まい方</h2>
        <img id="result-icon" src="" alt="診断結果アイコン" class="mx-auto h-14 mb-4 icon hidden" />
        <p id="resultText" class="mb-6 text-center leading-relaxed"></p>
        <div id="resultLinks" class="flex flex-col md:flex-row gap-4 justify-center"></div>
        <button id="restartDiagnosis" class="mt-6 text-sm text-gray-600 underline">もう一度診断する</button>
      </div>
    </div>
  </div>
</div>

<script>
  const modal = document.getElementById('diagnosisModal');
  const openBtn = document.getElementById('openDiagnosis');
  const closeBtn = document.getElementById('closeDiagnosis');
  const restartBtn = document.getElementById('restartDiagnosis');
  const steps = document.querySelectorAll('.step');
  const resultText = document.getElementById('resultText');
  const resultIcon = document.getElementById('result-icon');
  const resultLinks = document.getElementById('resultLinks');
  let answers = [];
  let currentStep = 1;

  function showStep(n) {
    steps.forEach(step => {
      step.classList.toggle('hidden', step.dataset.step != n && step.dataset.step != 'result');
    });
  }

  document.querySelectorAll('.diagnosis-option').forEach(button => {
    button.addEventListener('click', () => {
      answers.push(button.dataset.value);
      currentStep++;
      if (currentStep > 3) {
        const [q1, q2, q3] = answers;
        let text = '';
        let icon = '';
        let links = '';

        if (q2 === 'want-rent' && q3 === 'diy') {
          text = 'まずは “育てる住まい” から始めて、ゆくゆく “つくる” へ。';
          icon = '/assets/icons/icon_sprout.svg';
          links = '<a href="/rental.html" class="px-4 py-2 bg-[var(--color-accent)] text-white rounded">Rentalを見る</a>';
        } else if (q2 === 'want-buy' && q3 === 'with-pro') {
          text = '理想の住まいを、一緒に形にしていきましょう。';
          icon = '/assets/icons/icon_ruler.svg';
          links = '<a href="/design.html" class="px-4 py-2 bg-[var(--color-highlight)] text-white rounded">Designの事例を見る</a>';
        } else if (q2 === 'want-lease') {
          text = '空き家を活かして、新しい住まい手へ。';
          icon = '/assets/icons/icon_cycle.svg';
          links = '<a href="/contact.html" class="px-4 py-2 bg-gray-500 text-white rounded">オーナー向け相談はこちら</a>';
        } else {
          text = 'まずは “育てる住まい” から、一歩ずつ。';
          icon = '/assets/icons/icon_wateringcan.svg';
          links = '<a href="/rental.html" class="px-4 py-2 bg-[var(--color-accent)] text-white rounded">Rentalを見る</a>';
        }

        resultText.textContent = text;
        resultIcon.src = icon;
        resultIcon.classList.remove('hidden');
        resultLinks.innerHTML = links;
        showStep('result');
      } else {
        showStep(currentStep);
      }
    });
  });

  openBtn.addEventListener('click', () => {
    modal.classList.remove('hidden');
    answers = [];
    currentStep = 1;
    resultIcon.classList.add('hidden');
    resultText.textContent = '';
    resultLinks.innerHTML = '';
    showStep(1);
  });

  closeBtn.addEventListener('click', () => {
    modal.classList.add('hidden');
  });

  restartBtn?.addEventListener('click', () => {
    answers = [];
    currentStep = 1;
    resultIcon.classList.add('hidden');
    resultText.textContent = '';
    resultLinks.innerHTML = '';
    showStep(1);
  });
</script>
